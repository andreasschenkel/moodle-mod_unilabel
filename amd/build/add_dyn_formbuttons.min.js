define("mod_unilabel/add_dyn_formbuttons",["exports","mod_unilabel/contentloader","core/templates","core/notification","core/log"],(function(_exports,_contentloader,_templates,_notification,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * @author     Andreas Grabs <moodle@grabs-edv.de>
   * @copyright  2024 Andreas Grabs
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */let _formid,_type,_elements,_editorelements;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_contentloader=_interopRequireDefault(_contentloader),_templates=_interopRequireDefault(_templates),_log=_interopRequireDefault(_log);const registerActionButtons=(headerelement,index)=>{const context={type:_type,repeatindex:index,repeatnr:index+1};return _templates.default.renderForPromise("mod_unilabel/element_action_buttons",context).then((_ref=>{let{html:html,js:js}=_ref;headerelement.querySelector("div.d-flex").insertAdjacentHTML("beforeend",html),_templates.default.runTemplateJS(js)})).catch((error=>(0,_notification.exception)(error)))};_exports.init=(type,formid,contextid,courseid,prefix,elements,editorelements)=>{_type=type,_formid=formid,_elements=elements,_editorelements=editorelements;var thisform=document.querySelector("#"+formid);thisform.addEventListener("click",(e=>{if("deleteelement"==e.target.dataset.action){var index=e.target.dataset.id;_log.default.debug("Deleting element: "+index),(index=>{var headerelement=document.querySelector("#id_singleelementheader_"+index);headerelement&&headerelement.remove();var thisform=document.querySelector("#"+_formid),myparent=document.querySelector("#id_unilabelcontenthdr");if(myparent){var newelement;_elements.forEach((element=>{let name="unilabeltype_"+_type+"_"+element+"["+index+"]";_log.default.debug("Set dummy element "+name),(newelement=document.createElement("input")).type="hidden",newelement.name=name,newelement.value="",myparent.insertAdjacentElement("afterbegin",newelement)})),_editorelements.forEach((element=>{let name;name="unilabeltype_"+_type+"_"+element+"["+index+"][text]",_log.default.debug("Set dummy editorelement-text "+name),(newelement=document.createElement("input")).type="hidden",newelement.name=name,newelement.value="",myparent.insertAdjacentElement("afterbegin",newelement),name="unilabeltype_"+_type+"_"+element+"["+index+"][format]",_log.default.debug("Set dummy editorelement-format "+name),(newelement=document.createElement("input")).type="hidden",newelement.name=name,newelement.value=1,myparent.insertAdjacentElement("afterbegin",newelement),name="unilabeltype_"+_type+"_"+element+"["+index+"][itemid]",_log.default.debug("Set dummy editorelement-itemid "+name),(newelement=document.createElement("input")).type="hidden",newelement.name=name,newelement.value=0,myparent.insertAdjacentElement("afterbegin",newelement)}));const myevent=new CustomEvent("itemremoved",{detail:index});thisform.dispatchEvent(myevent)}})(index)}}));for(var headerelements=document.querySelectorAll('fieldset[id^="id_singleelementheader"]'),i=0;i<headerelements.length;i++){var headerelement=headerelements[i];_log.default.debug("looking for: "+headerelement.id),registerActionButtons(headerelement,i)}var button=document.querySelector("#button-"+formid);if(button){var repeatbutton=document.querySelector("#fitem_id_"+prefix+"add_more_elements_btn");repeatbutton&&repeatbutton.remove(),button.addEventListener("click",(e=>{var contentcontainerselector="#addcontent-"+formid,serviceparams={type:type,contextid:contextid,formid:formid,courseid:courseid,prefix:prefix},repeatindex=parseInt(e.target.form.multiple_chosen_elements_count.value);e.target.form.multiple_chosen_elements_count.value=repeatindex+1,serviceparams.repeatindex=repeatindex,_log.default.debug(serviceparams),new _contentloader.default(contentcontainerselector,"get_html",serviceparams,contextid).loadContent("beforebegin").then((()=>{const myevent=new CustomEvent("itemadded",{detail:repeatindex});return thisform.dispatchEvent(myevent),!0})).catch((error=>(0,_notification.exception)(error)))}))}}}));

//# sourceMappingURL=add_dyn_formbuttons.min.js.map
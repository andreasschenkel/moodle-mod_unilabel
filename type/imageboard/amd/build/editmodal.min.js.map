{"version":3,"file":"editmodal.min.js","sources":["../src/editmodal.js"],"sourcesContent":["/**\n * Unilabel type imageboard\n *\n * @author      Andreas Schenkel\n * @copyright   Andreas Schenkel {@link https://github.com/andreasschenkel}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// import modalHelper from 'mod_unilabel/modal_helper';\nimport $ from 'jquery'; // Still needed for actions on bootstrap 4 modal dialogs.\n\nconst fixModalPosition = (modalselector) => {\n    var modal = document.querySelector(modalselector);\n    var form = modal.closest('form');\n\n    $(modalselector).on('show.bs.modal', function() {\n        //$(this).appendTo('body');\n        form.append(modal);\n    });\n\n    // Hack for stacked modals to show the backdrop with the right z-index.\n    $(document).on('show.bs.modal', '.modal', function() {\n        var zIndex = 1040 + (10 * $('.modal:visible').length);\n        $(this).css('z-index', zIndex);\n        setTimeout(function() {\n            $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');\n        }, 100);\n    });\n\n    // Hack to enable stacked modals by making sure the .modal-open class\n    // is set to the <body> when there is at least one modal open left.\n    $(document).on('hidden.bs.modal', function() {\n        if ($('.modal.show').length > 0) {\n            $('body').addClass('modal-open');\n        }\n    });\n};\n\nexport const init = () => {\n    const modalId = 'unilabeltype_imageboard_modal'; // Define the modal prefix.\n    const formHeaderPrefix = 'id_singleelementheader_';\n    var hidenumber = 0;\n    var singelelementheader;\n    var counter = 0;\n\n    // Hide all elements with an id starting with \"formHeaderPrefix\"\n    while (counter < 10000) { // There shouldn't be more than 10000 elements.\n        singelelementheader = document.querySelector('#' + formHeaderPrefix + hidenumber);\n        if (!singelelementheader) {\n            break;\n        }\n        singelelementheader.classList.add('d-none'); // Hide the element by adding 'd-none' class.\n        hidenumber++;\n        counter++;\n    }\n\n    var actualnumber = -1; // Initialize the actual number to -1.\n    var currentparent = null; // Variable to store the current parent element.\n    fixModalPosition('#' + modalId); // Initialize the modal helper.\n    document.querySelector('#imageboardcontainer').addEventListener('click', function(e) {\n        if (e.target.dataset.type === 'imageaction') {\n            actualnumber = parseInt(e.target.dataset.number); // Set the actual number from the clicked element.\n            $('#' + modalId).modal(); // Show the modal.\n        }\n        if (e.target.dataset.type === 'deleteimage') {\n            e.stopPropagation();\n            e.preventDefault();\n            var deletenumber = parseInt(e.target.dataset.number); // Get the number of the image to delete.\n            $('#unilabel_imageboard_confirm_inline_' + deletenumber).modal(); // Show the confirmation modal.\n        }\n\n    });\n    $('#' + modalId).on('show.bs.modal', function() {\n        var src = document.querySelector('#' + formHeaderPrefix + actualnumber + ' .element-edit-container');\n        currentparent = src.parentElement; // Store the current parent element.\n        var dst = document.querySelector('#' + modalId + ' .modal-body');\n        dst.append(src); // Move the edit container to the modal body.\n    });\n    $('#' + modalId).on('hidden.bs.modal', function() {\n        var src = document.querySelector('#' + modalId + ' .modal-body .element-edit-container');\n        var dst = currentparent;\n        dst.append(src); // Move the edit container back to its original parent when the modal is hidden.\n    });\n\n    var mform = document.querySelector('[id^=\"mform\"]');\n    mform.addEventListener('itemadded', function(e) {\n        actualnumber = e.detail; // Set the actual number from the event detail.\n        $('#' + modalId).modal(); // Show the modal when a new item is added.\n    });\n\n    var modal = document.querySelector('#' + modalId + '.draggable'); // Get the draggable modal element.\n    var header = modal.querySelector('.modal-header'); // Get the modal header for drag functionality.\n\n    /**\n     * Handles the start of a drag operation on the modal.\n     * This function sets up event listeners for both mouse and touch events to enable dragging.\n     *\n     * @param {MouseEvent|TouchEvent} e - The event object for the mousedown or touchstart event.\n     */\n    function handleStart(e) {\n        e.preventDefault();\n        var touch = e.touches ? e.touches[0] : e;\n        var offsetX = touch.clientX - modal.getBoundingClientRect().left;\n        var offsetY = touch.clientY - modal.getBoundingClientRect().top;\n\n        /**\n         * Handles the movement of the modal during a drag operation.\n         * Updates the modal's position based on the current mouse or touch position.\n         *\n         * @param {MouseEvent|TouchEvent} e - The event object for the mousemove or touchmove event.\n         */\n        function moveHandler(e) {\n            e.preventDefault();\n            var moveTouch = e.touches ? e.touches[0] : e;\n            modal.style.left = (moveTouch.clientX - offsetX) + 'px';\n            modal.style.top = (moveTouch.clientY - offsetY) + 'px';\n        }\n\n        /**\n         * Handles the end of a drag operation.\n         * Removes all event listeners that were added for the drag operation.\n         */\n        function endHandler() {\n            document.removeEventListener('mousemove', moveHandler);\n            document.removeEventListener('mouseup', endHandler);\n            document.removeEventListener('touchmove', moveHandler);\n            document.removeEventListener('touchend', endHandler);\n        }\n\n        // Add all event listeners for the drag operations.\n        document.addEventListener('mousemove', moveHandler);\n        document.addEventListener('mouseup', endHandler);\n        document.addEventListener('touchmove', moveHandler);\n        document.addEventListener('touchend', endHandler);\n    }\n\n    // Add event listener for start dragging the modal.\n    header.addEventListener('mousedown', handleStart);\n    header.addEventListener('touchstart', handleStart);\n\n};\n"],"names":["fixModalPosition","modalselector","modal","document","querySelector","form","closest","on","append","zIndex","length","this","css","setTimeout","not","addClass","modalId","singelelementheader","hidenumber","counter","classList","add","actualnumber","currentparent","addEventListener","e","target","dataset","type","parseInt","number","stopPropagation","preventDefault","deletenumber","src","parentElement","detail","header","handleStart","touch","touches","offsetX","clientX","getBoundingClientRect","left","offsetY","clientY","top","moveHandler","moveTouch","style","endHandler","removeEventListener"],"mappings":";;;;;;;gJAWMA,iBAAoBC,oBAClBC,MAAQC,SAASC,cAAcH,eAC/BI,KAAOH,MAAMI,QAAQ,4BAEvBL,eAAeM,GAAG,iBAAiB,WAEjCF,KAAKG,OAAON,8BAIdC,UAAUI,GAAG,gBAAiB,UAAU,eAClCE,OAAS,KAAQ,IAAK,mBAAE,kBAAkBC,2BAC5CC,MAAMC,IAAI,UAAWH,QACvBI,YAAW,+BACL,mBAAmBC,IAAI,gBAAgBF,IAAI,UAAWH,OAAS,GAAGM,SAAS,iBAC9E,4BAKLZ,UAAUI,GAAG,mBAAmB,YAC1B,mBAAE,eAAeG,OAAS,uBACxB,QAAQK,SAAS,gCAKX,WACVC,QAAU,wCAGZC,oBADAC,WAAa,EAEbC,QAAU,EAGPA,QAAU,MACbF,oBAAsBd,SAASC,cAAc,2BAAyBc,cAItED,oBAAoBG,UAAUC,IAAI,UAClCH,aACAC,cAGAG,cAAgB,EAChBC,cAAgB,KACpBvB,iBAAiB,IAAMgB,SACvBb,SAASC,cAAc,wBAAwBoB,iBAAiB,SAAS,SAASC,MAChD,gBAA1BA,EAAEC,OAAOC,QAAQC,OACjBN,aAAeO,SAASJ,EAAEC,OAAOC,QAAQG,4BACvC,IAAMd,SAASd,SAES,gBAA1BuB,EAAEC,OAAOC,QAAQC,KAAwB,CACzCH,EAAEM,kBACFN,EAAEO,qBACEC,aAAeJ,SAASJ,EAAEC,OAAOC,QAAQG,4BAC3C,uCAAyCG,cAAc/B,gCAI/D,IAAMc,SAAST,GAAG,iBAAiB,eAC7B2B,IAAM/B,SAASC,cAAc,2BAAyBkB,aAAe,4BACzEC,cAAgBW,IAAIC,cACVhC,SAASC,cAAc,IAAMY,QAAU,gBAC7CR,OAAO0B,4BAEb,IAAMlB,SAAST,GAAG,mBAAmB,eAC/B2B,IAAM/B,SAASC,cAAc,IAAMY,QAAU,wCACvCO,cACNf,OAAO0B,QAGH/B,SAASC,cAAc,iBAC7BoB,iBAAiB,aAAa,SAASC,GACzCH,aAAeG,EAAEW,2BACf,IAAMpB,SAASd,eAGjBA,MAAQC,SAASC,cAAc,IAAMY,QAAU,cAC/CqB,OAASnC,MAAME,cAAc,0BAQxBkC,YAAYb,GACjBA,EAAEO,qBACEO,MAAQd,EAAEe,QAAUf,EAAEe,QAAQ,GAAKf,EACnCgB,QAAUF,MAAMG,QAAUxC,MAAMyC,wBAAwBC,KACxDC,QAAUN,MAAMO,QAAU5C,MAAMyC,wBAAwBI,aAQnDC,YAAYvB,GACjBA,EAAEO,qBACEiB,UAAYxB,EAAEe,QAAUf,EAAEe,QAAQ,GAAKf,EAC3CvB,MAAMgD,MAAMN,KAAQK,UAAUP,QAAUD,QAAW,KACnDvC,MAAMgD,MAAMH,IAAOE,UAAUH,QAAUD,QAAW,cAO7CM,aACLhD,SAASiD,oBAAoB,YAAaJ,aAC1C7C,SAASiD,oBAAoB,UAAWD,YACxChD,SAASiD,oBAAoB,YAAaJ,aAC1C7C,SAASiD,oBAAoB,WAAYD,YAI7ChD,SAASqB,iBAAiB,YAAawB,aACvC7C,SAASqB,iBAAiB,UAAW2B,YACrChD,SAASqB,iBAAiB,YAAawB,aACvC7C,SAASqB,iBAAiB,WAAY2B,YAI1Cd,OAAOb,iBAAiB,YAAac,aACrCD,OAAOb,iBAAiB,aAAcc"}